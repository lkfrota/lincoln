<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Relat√≥rio GD-FV Paran√° - Irradia√ß√£o Solar e Pot√™ncia Instalada</title>
    <meta name="description" content="An√°lise da Irradia√ß√£o Solar (GHI) Relativa e ranking dos Top 10 munic√≠pios do Paran√° com maior pot√™ncia instalada em Gera√ß√£o Distribu√≠da Fotovoltaica (GD-FV). Dados ANEEL e ERA5."/>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Quantico:wght@400;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f7f4;
            color: #334155;
        }
        .font-quantico {
            font-family: 'Quantico', sans-serif;
        }
    </style>
    <script src="https://cdn.plot.ly/plotly-3.3.0.min.js"></script>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Report",
      "headline": "Relat√≥rio GD FV Paran√° - Irradia√ß√£o Solar e Pot√™ncia Instalada",
      "description": "An√°lise da Irradia√ß√£o Solar Relativa (GHI) e ranking dos Top 10 munic√≠pios do Paran√° com maior pot√™ncia instalada em Gera√ß√£o Distribu√≠da Fotovoltaica (GD-FV). Dados ANEEL e ERA5.",
      "image": [
        "https://lkfrota.github.io/lincoln/graficos/top10Sep.png"
      ],
      "author": {
        "@type": "Person",
        "name": "Lincoln K. Frota",
        "url": "mailto:lkfrota@gmail.com"
      },
      "publisher": {
        "@type": "Organization",
        "name": "Lincoln K. Frota",
        "logo": {
          "@type": "ImageObject",
          "url": "https://lkfrota.github.io/lincoln/logo.png"
        }
      },
      "datePublished": "2025-09-01",
      "dateModified": "2026-02-09"
    }
    </script>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1VZWVH6B57"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-1VZWVH6B57');
    </script>
    <!-- Google tag (gtag.js) -->
    
    <!-- script para chamar e carregar os gr√°ficos -->
    <script>
    // URL da sua Cloud Function (API)
    const GCF_ENDPOINT = 'https://gd-pr-report-547250988053.southamerica-east1.run.app/'; 
    
    // IDs dos cont√™ineres para os mapas
    const CLIM_CONTAINER_ID = 'mapa-clim-container';
    const PREV_CONTAINER_ID = 'mapa-prev-container';
    const TOP10_CONTAINER_ID = 'top10-container';

    // Fun√ß√£o principal para carregar os gr√°ficos com base na sele√ß√£o (mensal/ytd)
    function loadNewCharts(viewType) {
        let climKey, prevKey;
        
        // Mapeamento da Visualiza√ß√£o para as Chaves da API
        if (viewType === 'ytd') {
            climKey = 'ghi_ytd_clim';
            prevKey = 'ghi_ytd_prev';
            document.getElementById('view-title-span').textContent = 'Desvio Acumulado no Ano';
        } else {
            // Padr√£o: 'mensal'
            climKey = 'ghi_clim';
            prevKey = 'ghi_prev';
            document.getElementById('view-title-span').textContent = 'Desvio Mensal';
        }

        // 1. Chamada para o Mapa Clim/YTD Clim
        fetchAndRenderChart(climKey, CLIM_CONTAINER_ID);

        // 2. Chamada para o Mapa Prev/YTD Prev
        fetchAndRenderChart(prevKey, PREV_CONTAINER_ID);
        
        // NOTA: Para o Top 10, voc√™ pode chamar fetchAndRenderChart('top10_bar', TOP10_CONTAINER_ID); quando implementado
    }

    function fetchAndRenderChart(chartType, containerId) {
        const url = `${GCF_ENDPOINT}?chart_type=${chartType}`;
        const container = document.getElementById(containerId);
    
        // Display loading message directly in the container. Plotly.newPlot will overwrite this.
        container.innerHTML = '<div class="text-center py-10 text-xl text-slate-400">Carregando gr√°fico...</div>'; 

        fetch(url)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Erro na API (Status ${response.status}): ${response.statusText}`);
                }
            // üõë 
                return response.json();
            })
            .then(plotData => {
                // 1. Ajuste da Colorbar (Tratando cada tra√ßo do gr√°fico)
                if (plotData.data) {
                    plotData.data.forEach(trace => {
                        // Verifica se o tra√ßo possui colorbar (comum em mapas/heatmaps)
                        let cb = trace.colorbar || (trace.marker && trace.marker.colorbar);
                        if (cb) {
                            cb.orientation = 'h';   // Horizontal
                            cb.y = -0.2;            // Posiciona abaixo da √°rea de plotagem
                            cb.x = 0.5;               // Alinhado √† esquerda da √°rea de plotagem
                            cb.xanchor = 'center';
                            cb.len = 0.8;             // Largura total da √°rea de plotagem
                            cb.thickness = 20;      // Espessura da barra
                            if (cb.title) {
                                cb.title.side = 'top'; // T√≠tulo da legenda acima da barra
                            }
                        }
                    });
                }
                const updatedLayout = {
                    ...plotData.layout,
                    title: {
                        automargin: true,
                        text: (plotData.layout.title && plotData.layout.title.text) ? plotData.layout.title.text : (typeof plotData.layout.title === 'string' ? plotData.layout.title : ""),
                        x: 0.5,
                        xanchor: 'center',
                        yanchor: 'top',
                        pad: {t: 10},
                        font: {size: 24},
                        subtitle: {
                            text: (plotData.layout.title.subtitle && plotData.layout.title.subtitle.text) ? plotData.layout.title.subtitle.text : (typeof plotData.layout.title.subtitle === 'string' ? plotData.layout.title.subtitle : ""),
                            font: {size: 16},
                        },
                    },
                    margin: {
                        t: 80, // Espa√ßo para t√≠tulo maior
                        b: 80,  // Espa√ßo para colorbar horizontal
                        l: 40,
                        //r: 80,
                        pad: 0,
                    },                        
                    autosize: true, // Enable Plotly's internal autosizing based on container dimensions
                    width: null,    // Explicitly nullify width to allow CSS/container to dictate it
                    height: null,   // Explicitly nullify height to allow CSS/container to dictate it
                    xaxis: {
                        ...(plotData.layout.xaxis || {}), // Preserves existing X-axis properties
                        constrain: 'domain',         // Optional: Constrain axis range to plot's domain
                    },
                    yaxis: {
                        ...(plotData.layout.yaxis || {}), // Preserves existing Y-axis properties
                    },
                };
                
                // Configuration for Plotly rendering, enabling full responsiveness
                const config = {
                    responsive: true,     // Makes the plot responsive to window resizing
                    displayModeBar: true, // Optional: Hides the Plotly toolbar for a cleaner user experience
                    displaylogo: false,   // Remove o √≠cone do Plotly para limpar a UI
                    toImageButtonOptions: {scale: 2} // Alta resolu√ß√£o
                        
                };

                // Remove any existing plot before creating a new one to prevent potential issues
                // with Plotly.newPlot when an element already contains a plot.
                if (container.__plotly_editor_children) { 
                    Plotly.purge(containerId);
                }

                // Render the new plot with updated layout and configuration
                Plotly.newPlot(containerId, plotData.data, updatedLayout, config);
            })
            .catch(error => {
                console.error("Erro ao buscar ou renderizar gr√°fico:", error);
                container.innerHTML = `<p class="text-center py-10 text-red-500">Erro ao carregar o gr√°fico ${chartType}. Verifique o console.</p>`;
            });
    }

    // Inicializa com os gr√°ficos mensais ao carregar a p√°gina
    document.addEventListener('DOMContentLoaded', () => {
        loadNewCharts('mensal');
        
        // Opcional: Chama o gr√°fico Top 10 (se for implementado via API)
        // fetchAndRenderChart('top10_bar', TOP10_CONTAINER_ID); 
    });
    </script>
</head>
<body class="antialiased">

    <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-50 shadow-sm">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <h1 class="font-quantico text-base sm:text-lg md:text-xl font-bold text-slate-700">ENERGIA SOLAR FOTOVOLTAICA NO PARAN√Å</h1>
            <span class="font-quantico text-sm sm:text-base md:text-xl font-bold text-slate-700">GD - GERA√á√ÉO DISTRIBU√çDA</span>
        </nav>
    </header>

    <main class="container mx-auto px-6 py-3 md:py-6">

        <section id="visualization" class="py-3 md:py-6">
            <div class="text-center max-w-4xl mx-auto px-6">
                <h3 class="font-quantico text-3xl md:text-4xl font-bold text-slate-800 mb-4">
                    <span id="view-title-span">Desvio Irradia√ß√£o Solar (GHI) no Paran√°</span>
                </h3>
                <p class="text-slate-600 mb-8 max-w-3xl mx-auto">
                    A s√≠ntese de irradi√¢ncia global horizontal (GHI) √© refer√™ncia para gera√ß√£o el√©trica fotovoltaica. 
                    A propor√ß√£o com per√≠odos anteriores serve como comparativo no monitoramento de geradores em opera√ß√£o.
                    Para per√≠odos anteriores √© sempre usado o respectivo no ciclo solar, ou seja, de Janeiro a Abril s√≥ √© comparado com Janeiro a Abril de um ou m√∫ltiplos anos.
                </p>
                <!-- Aqui parece ser o seletor de lista -->
                <div class="mb-8">
                    <label for="view_selector" class="text-lg font-semibold text-slate-700 mr-4">Visualiza√ß√£o:</label>
                    <select id="view_selector" onchange="loadNewCharts(this.value)" 
                            class="p-2 border border-slate-300 rounded-lg shadow-sm focus:ring-slate-500 focus:border-slate-500">
                        <option value="mensal">Mensal (M√™s Atual vs. Hist√≥rico/Anterior)</option>
                        <option value="ytd">Acumulada (Acumulado Ano vs. Hist√≥rico/Anterior)</option>
                    </select>
                </div>
                <!-- Aqui o primeiro mapa -->
                <figure class="w-full max-w-4xl mx-auto mt-8 rounded-2xl shadow-2xl overflow-hidden border-4 border-white relative">
                    <div id="mapa-clim-container" class="min-h-[668px]">
                        <!-- Plotly content will be rendered here, replacing initial loading text -->
                    </div>
                    <figcaption class="p-4 text-center text-sm text-slate-500 bg-white">
                        Mapa da Irradia√ß√£o Solar (GHI) - Relativo √† M√©dia Longa.
                    </figcaption>
                </figure>
                <!-- Aqui o segundo mapa -->
                <figure class="w-full max-w-4xl mx-auto mt-8 rounded-2xl shadow-2xl overflow-hidden border-4 border-white relative">
                    <div id="mapa-prev-container" class="min-h-[668px]">
                        <!-- Plotly content will be rendered here, replacing initial loading text -->
                    </div>
                    <figcaption class="p-4 text-center text-sm text-slate-500 bg-white w-full max-w-4xl mx-auto">
                        Irradia√ß√£o Solar (GHI) no Paran√° - Relativo ao Mesmo per√≠odo do Ano Passado.
                    </figcaption>
                </figure>          
            </div>
            <!-- Aqui o top10 -->
            <div class="text-center max-w-4xl mx-auto px-6 mt-16">
                <h3 class="font-quantico text-3xl md:text-4xl font-bold text-slate-800 mb-4">Top 10 Cidades em Pot√™ncia GD FV Instalada</h3>
                <p class="text-slate-600 mb-8 max-w-3xl mx-auto">
                    Este gr√°fico apresenta a evolu√ß√£o nos √∫ltimos 24 meses dos 10 munic√≠pios paranaenses com maior pot√™ncia instalada em gera√ß√£o distribu√≠da fotovoltaica atualmente, 
                    segundo dados da ANEEL disponibilizados publicamente.
                </p>
            </div>
            <div class="w-full max-w-4xl mx-auto mt-8 rounded-2xl shadow-2xl overflow-hidden border-4 border-white">
                <figure class="m-0">
                    <img src="graficos/top10Jan.png" alt="Gr√°fico Top 10 Munic√≠pios Paran√° Pot√™ncia Instalada GD" class="w-full h-auto" loading="lazy">
                    <figcaption class="p-4 text-center text-sm text-slate-500 bg-white">
                        Gr√°fico: Evolu√ß√£o 24 Meses Top 10 Munic√≠pios com Gera√ß√£o Distribu√≠da no Paran√°.
                    </figcaption>
                </figure>
            </div>
        </section>

        <section id="about" class="py-16 md:py-24 max-w-3xl mx-auto">
            <h3 class="font-quantico text-3xl md:text-4xl font-bold text-slate-800 mb-4">Sobre o Relat√≥rio</h3>
            <p class="text-slate-600 text-lg mb-4">
                Este relat√≥rio √© uma s√≠ntese dos dados de Global Horizontal Irradiance (GHI) e Gera√ß√£o Distribuida Fotovoltaica (GD-FV) para o estado do Paran√°. 
                Visa oferecer uma vis√£o resumida das condi√ß√µes recentes para esse setor produtivo.
                Os dados de irradi√¢ncia foram obtidos da plataforma Oikolab, que disponibiliza o modelo clim√°tico ERA5, 
                a mais recente gera√ß√£o de rean√°lise de dados produzido pela Copernicus Climate Change Service (C3S), implementado pelo ECMWF.
            </p>
            <p class="text-slate-600 text-lg">
                O GHI √© um fator cr√≠tico para a estimativa de produ√ß√£o de energia, e esta an√°lise visa fornecer informa√ß√µes de refer√™ncia 
                para engenheiros, projetistas, operadores e investidores, ajudando na tomada de decis√µes e na orienta√ß√£o de
                avalia√ß√£o de performance de projetos de gera√ß√£o distribu√≠da em opera√ß√£o.
            </p>
        </section>
        
        <section id="contact" class="py-4 md:py-8">
            <div class="text-center max-w-3xl mx-auto px-6">
                <h2 class="font-quantico text-3xl md:text-4xl font-bold text-slate-800 mb-4">üìû Entre em Contato</h2>
                <p class="text-slate-600 mb-10">
                    Gostou do relat√≥rio? Gostaria de reportar uma corre√ß√£o? Consultar uma aplica√ß√£o? Adapta√ß√£o? Melhoria? Entre em contato comigo pelos canais abaixo.
                </p>
                <div class="grid grid-cols-1 sm:grid-cols-1 gap-6">
                    <!-- Para usar uma imagem, substitua o emoji pela tag <img> e adicione o arquivo 'wa-logo.png' na mesma pasta.
                    <a href="https://wa.me/5541999358444" target="_blank" class="action-button bg-white p-6 rounded-xl shadow-md hover:shadow-xl border border-slate-200/80 flex flex-col items-center justify-center">
                        <img src="wa-logo.png" alt="Logo WhatsApp" class="w-10 h-10 mb-3 mx-auto">
                        <h3 class="font-bold text-lg text-slate-700">WhatsApp</h3>
                        <p class="text-slate-500">Envie uma mensagem</p>
                    </a>
                    <a href="tel:+5541999358444" class="action-button bg-white p-6 rounded-xl shadow-md hover:shadow-xl border border-slate-200/80 flex flex-col items-center justify-center">
                        <div class="text-4xl mb-3" aria-hidden="true">üì±</div>
                        <h3 class="font-bold text-lg text-slate-700">Ligar</h3>
                        <p class="text-slate-500" aria-label="Telefone 41 99935 8444">(41) 99935-8444</p>
                    </a> -->
                    <a href="mailto:lkfrota@gmail.com" class="action-button bg-white p-6 rounded-xl shadow-md hover:shadow-xl border border-slate-200/80 inline-flex flex-col items-center justify-center">
                        <div class="text-4xl mb-3" aria-hidden="true">‚úâÔ∏è</div>
                        <h3 class="font-bold text-lg text-slate-700">E-mail</h3>
                        <p class="text-slate-500">lkfrota@gmail.com</p>
                    </a>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-slate-800 text-slate-400 py-8">
        <div class="container mx-auto px-6 text-center">
            <p>&copy; 2025 Lincoln K. Frota. Todos os direitos reservados.</p>
            <p class="text-sm mt-2">GD Fotovoltaica no Paran√°.</p>
        </div>
    </footer>

</body>
</html>
